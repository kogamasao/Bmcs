# 詳細設計書 - 試合管理

## 1. 試合一覧 (G030)

### 1.1 画面レイアウト
| 項目名 | 物理名 | 表示内容 | 備考 |
| --- | --- | --- | --- |
| 日付 | Game.GameDateFormat | Text | yyyy/MM/dd |
| 試合種別 | Game.GameClassName | Text | 公式戦、練習試合など |
| 相手チーム | Game.OpponentTeamName | Text | |
| 球場 | Game.StadiumName | Text | |
| 天候 | Game.WeatherClassName | Text | |
| 勝敗 | Game.WinLoseClassName | Text | 〇、●、△ |
| スコア | Game.GameScore | Text | 自チーム得点 - 相手チーム得点 |
| ステータス | Game.StatusClassName | Text | 試合前、試合中、試合終了など |
| 操作 | - | Button | 試合入力、結果編集、結果表示、編集、削除 |

### 1.2 処理ロジック
1.  **データ取得**:
    - `teamID` パラメータで指定されたチームの試合を取得。
    - 削除フラグ (`DeleteFLG`) が false のレコード。
    - 日付の降順で表示。
2.  **ボタン制御**:
    - **試合入力**: ステータスが「試合中」の場合に表示。一球速報入力画面へ。
    - **試合結果編集**: ステータスが「試合前(オーダー確定後)」「試合終了」の場合に表示。
    - **試合結果**: ステータスが「試合終了」「試合終了(ロック)」の場合に表示。
    - **編集/削除**: 自分のチームまたは管理者の場合のみ表示。ロック状態では非表示。

## 2. 試合登録 (G032)

### 2.1 画面レイアウト
| 項目名 | 物理名 | 型 | 必須 | 制約・備考 |
| --- | --- | --- | --- | --- |
| 日付 | Game.GameDate | Date | Yes | |
| 試合種別 | Game.GameClass | Select | No | |
| 相手チーム名 | Game.OpponentTeamName | Text | No | |
| 相手チーム略名 | Game.OpponentTeamAbbreviation | Text | No | |
| 球場 | Game.StadiumName | Text | No | |
| 天候 | Game.WeatherClass | Select | No | |
| 先攻後攻 | Game.BatFirstBatSecondClass | Select | No | 自チームが先攻か後攻か |
| 試合入力タイプ | Game.GameInputTypeClass | Select | No | 一球速報 / 試合結果のみ |

### 2.2 処理ロジック
1.  **データ保存**:
    - `Games` テーブルに INSERT。
    - ステータスは「試合前」で初期化。
2.  **画面遷移**:
    - **一球速報 (ByPlay)**: オーダー編集画面 (`/Order/Edit`) へリダイレクト。
    - **試合結果のみ (Score)**: 試合結果編集画面 (`/GameScore/Edit`) へリダイレクト。

## 3. 試合詳細（スコアボード） (G060)

### 3.1 画面レイアウト
- **スコアボード**: イニングごとの得点、合計得点 (R)。
- **投手成績**: 登板した投手の成績一覧（回、安打、三振、四死球、自責点など）。
- **野手成績**: 出場した野手の成績一覧（打数、安打、打点、盗塁、守備成績など）。
- **動画**: 動画コードが設定されている場合、埋め込み動画を表示。

### 3.2 処理ロジック
1.  **データ取得**:
    - `GameID` に紐づく `InningScores`, `GameScorePitchers`, `GameScoreFielders` を取得。
    - 一球速報モードの場合、イニングスコアのリンクからイニング詳細画面へ遷移可能。

## 4. 試合結果編集 (G061)

### 4.1 画面レイアウト
- **イニングスコア編集**: イニングごとの得点を入力。
- **投手成績編集**: 投手ごとの詳細成績を入力・編集。行追加・削除可能。
- **野手成績編集**: 野手ごとの詳細成績を入力・編集。行追加・削除可能。
- **再集計ボタン**: 一球速報モードの場合のみ表示。入力されたプレーデータから成績を再計算する。

### 4.2 処理ロジック
1.  **データ保存**:
    - 入力されたスコア、成績データを更新。
    - ステータスを「試合終了」に更新（確定ボタン押下時）。
2.  **再集計処理**:
    - `GameScenes` テーブルのデータを元に、スコアと個人成績を再計算して画面に反映。

## 5. 試合経過入力 (G050)

### 5.1 画面レイアウト
- **スコアボード**: 現在のイニングスコア。
- **守備情報**: 現在の投手。
- **打席情報**: 現在の打者、打順、守備位置。
- **打席結果入力**: 打球方向、打球種類、結果（ヒット、アウトなど）を選択。
- **ランナー結果入力**: 盗塁、暴投などによるランナーの進塁・アウトを入力。
- **操作ボタン**: 次の打者へ、チェンジ、試合終了。

### 5.2 処理ロジック
1.  **データ保存**:
    - 1打席の結果を `GameScenes` テーブルに保存。
    - 詳細結果（盗塁など）を `GameSceneDetails`, `GameSceneRunners` に保存。
2.  **進行制御**:
    - アウトカウント、ランナー状況、得点を自動計算して更新。
    - 3アウトでチェンジ（攻守交代）。
    - 規定イニング終了またはサヨナラで試合終了判定。
